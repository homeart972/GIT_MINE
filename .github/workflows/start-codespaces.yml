name: Start GitHub Codespaces

on:
  workflow_dispatch:  # Permet de lancer manuellement
  schedule:
    - cron: '45 18 * * *'  # DÃ©clenche Ã  18h45 UTC
    - cron: '45 19 * * *'  # RedÃ©marrage Ã  19h45 si besoin

jobs:
  start-codespace:
    runs-on: ubuntu-latest
    steps:
      - name: Start Codespace
        run: |
          codespace_name=$(gh codespace list --json name,state | jq -r '.[] | select(.state=="Shutdown") | .name')
          if [ -n "$codespace_name" ]; then
            echo "ğŸ”„ RedÃ©marrage du Codespace : $codespace_name"
            gh codespace start --repo homeart972/GIT_MINE --name "$codespace_name"
          else
            echo "âœ… Aucun Codespace Ã  redÃ©marrer."
          fi
        env:
          GH_TOKEN: ${{ secrets.GH_PAT2 }}  # Utilisation du token personnel

      - name: VÃ©rifier et dÃ©marrer cron
        run: |
          echo "ğŸ” VÃ©rification du statut de cron..."
          if pgrep cron > /dev/null; then
            echo "âœ… Le service cron est dÃ©jÃ  en cours d'exÃ©cution."
          else
            echo "ğŸš€ DÃ©marrage du service cron..."
            sudo service cron start
          fi
          
          # VÃ©rification du dÃ©marrage
          sudo service cron status

